# ì§€ì—­ ê¸°ë°˜ ì‹ë‹¹ íƒìƒ‰ ë° ì¶”ì²œ ê¸°ëŠ¥

## ê°œìš”

í˜„ì¬ ì‹œìŠ¤í…œì€ **íŠ¹ì • ì‹ë‹¹ ì´ë¦„ + ì§€ì—­**ìœ¼ë¡œ ìœ„ìƒì •ë³´ë¥¼ ì¡°íšŒí•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.
ìƒˆ ê¸°ëŠ¥ì€ **ì§€ì—­ë§Œìœ¼ë¡œ ì‹ë‹¹ì„ íƒìƒ‰í•˜ê³  ì¡°ê±´ì— ë§ëŠ” ì‹ë‹¹ì„ ì¶”ì²œ**í•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.

### ì§€ì›í•˜ê³ ì í•˜ëŠ” ì§ˆë¬¸ ìœ í˜•

| ì§ˆë¬¸ ì˜ˆì‹œ | ì˜ë„ |
|----------|------|
| "ê°•ë‚¨êµ¬ì— ìˆëŠ” í–‰ì •ì²˜ë¶„ ì´ë ¥ì´ ìˆëŠ” ì‹ë‹¹ ì •ë³´ ì•Œë ¤ì¤˜" | ìœ„ë°˜ ì´ë ¥ ìˆëŠ” ì‹ë‹¹ ì¡°íšŒ |
| "ì‹ ë„ë¦¼ì—­ ê·¼ì²˜ ê¹¨ë—í•œ ì‹ë‹¹ ì•Œë ¤ì¤˜" | ìœ„ìƒë“±ê¸‰ ìš°ìˆ˜ ì‹ë‹¹ ì¶”ì²œ |
| "í™ëŒ€ ë§›ì§‘ ì¤‘ ìœ„ìƒë“±ê¸‰ ì¢‹ì€ ê³³" | ì§€ì—­ + ìœ„ìƒë“±ê¸‰ í•„í„° |
| "ì´ ë™ë„¤ ì‹ë‹¹ ì¤‘ í–‰ì •ì²˜ë¶„ ë°›ì€ ê³³ ìˆì–´?" | ì§€ì—­ ë‚´ ìœ„ë°˜ ì‹ë‹¹ í™•ì¸ |

---

## í˜„ì¬ ì‹œìŠ¤í…œ ë¶„ì„

### ê¸°ì¡´ MCP ë„êµ¬

```typescript
get_restaurant_hygiene({
  restaurant_name: string,  // í•„ìˆ˜: ì‹ë‹¹ëª…
  region: string,           // í•„ìˆ˜: ì§€ì—­
  include_history?: boolean
})
```

### ì¹´ì¹´ì˜¤ë§µ API ì œì•½ì‚¬í•­

| í•­ëª© | ì œí•œ |
|------|------|
| í˜ì´ì§€ë‹¹ ê²°ê³¼ | ìµœëŒ€ 15ê°œ |
| ìµœëŒ€ í˜ì´ì§€ | 3í˜ì´ì§€ (45ê°œ) |
| ë°˜í™˜ ê°€ëŠ¥ ì´ ê°œìˆ˜ | ìµœëŒ€ 45ê°œ |
| ì´ ê²€ìƒ‰ ê²°ê³¼ ìˆ˜ í™•ì¸ | `meta.total_count`ë¡œ ê°€ëŠ¥ |

### ì‹ì•½ì²˜ API ì œì•½ì‚¬í•­

| API | ì œí•œ |
|-----|------|
| C004 (ìœ„ìƒë“±ê¸‰) | ìš”ì²­ë‹¹ ìµœëŒ€ 100ê±´ |
| I2630 (í–‰ì •ì²˜ë¶„) | ìš”ì²­ë‹¹ ìµœëŒ€ 100ê±´ |

---

## ìƒˆ ê¸°ëŠ¥ ì„¤ê³„

### í•µì‹¬ ì›ì¹™

1. **ì ì§„ì  ì§€ì—­ ì„¸ë¶„í™”**: ê²°ê³¼ê°€ 50ê°œ ì´ˆê³¼ ì‹œ ì‚¬ìš©ìì—ê²Œ ì§ˆë¬¸í•˜ì—¬ ë²”ìœ„ ì¶•ì†Œ
2. **Claude ì£¼ë„ ëŒ€í™”**: ë„êµ¬ê°€ ìƒíƒœë¥¼ ë°˜í™˜í•˜ë©´ Claudeê°€ ì ì ˆí•œ ì§ˆë¬¸ ìƒì„±
3. **ì¼ê´„ ì²˜ë¦¬ ìµœì í™”**: ì§€ì—­ì´ í™•ì •ë˜ë©´ ì‹ë‹¹ë“¤ì˜ ìœ„ìƒì •ë³´ë¥¼ ì¼ê´„ ì¡°íšŒ

### ìƒˆ MCP ë„êµ¬

#### 1. `search_area_restaurants`

ì§€ì—­ ë‚´ ìŒì‹ì /ì¹´í˜ íƒìƒ‰

```typescript
// Input
{
  area: string,              // ì§€ì—­ëª… (ì˜ˆ: "ê°•ë‚¨êµ¬", "ì—­ì‚¼ì—­", "í™ëŒ€ì…êµ¬")
  category?: 'restaurant' | 'cafe' | 'all'  // ê¸°ë³¸ê°’: 'all'
}

// Output
{
  status: 'ready' | 'too_many' | 'not_found',
  total_count: number,       // ì´ ê²€ìƒ‰ ê²°ê³¼ ìˆ˜
  restaurants?: RestaurantInfo[],  // status='ready'ì¼ ë•Œ (ìµœëŒ€ 45ê°œ)
  suggestions?: string[],    // status='too_many'ì¼ ë•Œ ì„¸ë¶„í™” ì œì•ˆ
  message: string            // ìƒíƒœ ì„¤ëª… ë©”ì‹œì§€
}
```

**ë™ì‘ íë¦„**:
```
area="ê°•ë‚¨êµ¬" â†’ total_count=523
  â†’ status='too_many'
  â†’ suggestions=['ì—­ì‚¼ë™', 'ì‚¼ì„±ë™', 'ì²­ë‹´ë™', ...]

area="ì—­ì‚¼ì—­" â†’ total_count=42
  â†’ status='ready'
  â†’ restaurants=[...42ê°œ]
```

#### 2. `get_bulk_hygiene_info`

ì—¬ëŸ¬ ì‹ë‹¹ì˜ ìœ„ìƒì •ë³´ ì¼ê´„ ì¡°íšŒ ë° í•„í„°ë§

```typescript
// Input
{
  restaurants: Array<{
    name: string,
    address: string
  }>,
  filter?: 'all' | 'clean' | 'with_violations' | 'no_grade',
  limit?: number  // ë°˜í™˜í•  ìµœëŒ€ ê°œìˆ˜ (ê¸°ë³¸ê°’: 10)
}

// Output
{
  total_checked: number,
  matched_count: number,
  results: Array<{
    restaurant: RestaurantInfo,
    hygiene_grade?: HygieneGrade,
    violations?: ViolationHistory,
    match_reason: string  // í•„í„° ë§¤ì¹­ ì´ìœ 
  }>
}
```

**í•„í„° ì˜µì…˜**:

| í•„í„° | ì„¤ëª… | ë§¤ì¹­ ì¡°ê±´ |
|------|------|----------|
| `all` | ëª¨ë“  ì‹ë‹¹ | ì „ì²´ ë°˜í™˜ |
| `clean` | ê¹¨ë—í•œ ì‹ë‹¹ | AAA/AA ë“±ê¸‰ AND ìµœê·¼ 3ë…„ í–‰ì •ì²˜ë¶„ ì—†ìŒ |
| `with_violations` | í–‰ì •ì²˜ë¶„ ì´ë ¥ | í–‰ì •ì²˜ë¶„ ê¸°ë¡ 1ê±´ ì´ìƒ |
| `no_grade` | ë“±ê¸‰ ë¯¸ë“±ë¡ | ìœ„ìƒë“±ê¸‰ ë¯¸ë“±ë¡ ì‹ë‹¹ |

---

## ëŒ€í™” í”Œë¡œìš° ì˜ˆì‹œ

### ì˜ˆì‹œ 1: ê¹¨ë—í•œ ì‹ë‹¹ ì¶”ì²œ

```
ğŸ‘¤ User: "ì‹ ë„ë¦¼ì—­ ê·¼ì²˜ ê¹¨ë—í•œ ì‹ë‹¹ ì•Œë ¤ì¤˜"

ğŸ”§ Claude: [search_area_restaurants({ area: "ì‹ ë„ë¦¼ì—­ ìŒì‹ì " })]
   â†’ { status: 'ready', total_count: 38, restaurants: [...] }

ğŸ”§ Claude: [get_bulk_hygiene_info({
     restaurants: [...],
     filter: 'clean',
     limit: 5
   })]
   â†’ { matched_count: 3, results: [...] }

ğŸ’¬ Claude: "ì‹ ë„ë¦¼ì—­ ê·¼ì²˜ì—ì„œ ìœ„ìƒë“±ê¸‰ì´ ìš°ìˆ˜í•œ ì‹ë‹¹ 3ê³³ì„ ì°¾ì•˜ì–´ìš”:

1. ğŸŒŸğŸŒŸğŸŒŸ ë³¸ì£½&ë¹„ë¹”ë°¥ ì‹ ë„ë¦¼ì 
   - ë“±ê¸‰: AAA (ë§¤ìš° ìš°ìˆ˜)
   - ì£¼ì†Œ: êµ¬ë¡œêµ¬ ê²½ì¸ë¡œ 661
   - ìµœê·¼ 3ë…„ í–‰ì •ì²˜ë¶„: ì—†ìŒ

2. ğŸŒŸğŸŒŸ ìŠ¤íƒ€ë²…ìŠ¤ ì‹ ë„ë¦¼ì—­ì 
   - ë“±ê¸‰: AA (ìš°ìˆ˜)
   - ì£¼ì†Œ: êµ¬ë¡œêµ¬ ìƒˆë§ë¡œ 97
   - ìµœê·¼ 3ë…„ í–‰ì •ì²˜ë¶„: ì—†ìŒ

3. ğŸŒŸğŸŒŸ ë§¥ë„ë‚ ë“œ ì‹ ë„ë¦¼ì 
   - ë“±ê¸‰: AA (ìš°ìˆ˜)
   - ì£¼ì†Œ: êµ¬ë¡œêµ¬ ê²½ì¸ë¡œ 643
   - ìµœê·¼ 3ë…„ í–‰ì •ì²˜ë¶„: ì—†ìŒ"
```

### ì˜ˆì‹œ 2: ì§€ì—­ ì„¸ë¶„í™” í•„ìš”

```
ğŸ‘¤ User: "ê°•ë‚¨êµ¬ì— ìˆëŠ” í–‰ì •ì²˜ë¶„ ì´ë ¥ì´ ìˆëŠ” ì‹ë‹¹ ì •ë³´ ì•Œë ¤ì¤˜"

ğŸ”§ Claude: [search_area_restaurants({ area: "ê°•ë‚¨êµ¬ ìŒì‹ì " })]
   â†’ { status: 'too_many', total_count: 523, suggestions: [...] }

ğŸ’¬ Claude: "ê°•ë‚¨êµ¬ì— 500ê°œ ì´ìƒì˜ ì‹ë‹¹ì´ ìˆì–´ì„œ ë²”ìœ„ë¥¼ ì¢í˜€ì•¼ í•´ìš”.
   ì–´ëŠ ì§€ì—­ì„ ì°¾ìœ¼ì‹œë‚˜ìš”?

   - ì—­ì‚¼ë™/ì—­ì‚¼ì—­ ê·¼ì²˜
   - ì‚¼ì„±ë™/ì‚¼ì„±ì—­ ê·¼ì²˜
   - ì²­ë‹´ë™/ì²­ë‹´ì—­ ê·¼ì²˜
   - ë…¼í˜„ë™/ë…¼í˜„ì—­ ê·¼ì²˜
   - ì‹ ì‚¬ë™/ì‹ ì‚¬ì—­ ê·¼ì²˜"

ğŸ‘¤ User: "ì—­ì‚¼ì—­"

ğŸ”§ Claude: [search_area_restaurants({ area: "ì—­ì‚¼ì—­ ìŒì‹ì " })]
   â†’ { status: 'ready', total_count: 42, restaurants: [...] }

ğŸ”§ Claude: [get_bulk_hygiene_info({
     restaurants: [...],
     filter: 'with_violations',
     limit: 10
   })]
   â†’ { matched_count: 2, results: [...] }

ğŸ’¬ Claude: "ì—­ì‚¼ì—­ ê·¼ì²˜ì—ì„œ í–‰ì •ì²˜ë¶„ ì´ë ¥ì´ ìˆëŠ” ì‹ë‹¹ 2ê³³ì´ì—ìš”:

1. âš ï¸ OOì¹˜í‚¨ ì—­ì‚¼ì 
   - ìµœê·¼ ì²˜ë¶„: 2024-03-15 ì˜ì—…ì •ì§€ 7ì¼
   - ì‚¬ìœ : ìœ„ìƒìƒíƒœ ë¶ˆëŸ‰
   - ì£¼ì†Œ: ê°•ë‚¨êµ¬ ì—­ì‚¼ë¡œ 123

2. âš ï¸ XXë¶„ì‹
   - ìµœê·¼ ì²˜ë¶„: 2023-11-20 ê³¼íƒœë£Œ 50ë§Œì›
   - ì‚¬ìœ : ì‹í’ˆí‘œì‹œê¸°ì¤€ ìœ„ë°˜
   - ì£¼ì†Œ: ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 456"
```

---

## êµ¬í˜„ ê³„íš

### Phase 1: ì¹´ì¹´ì˜¤ë§µ ì„œë¹„ìŠ¤ í™•ì¥

**íŒŒì¼**: `src/services/kakao-map.service.ts`

```typescript
// ìƒˆ ë©”ì„œë“œ ì¶”ê°€
interface AreaSearchResult {
  status: 'ready' | 'too_many' | 'not_found';
  totalCount: number;
  restaurants: RestaurantInfo[];
  suggestions?: string[];
}

async searchByArea(area: string, category?: string): Promise<AreaSearchResult>
```

**êµ¬í˜„ ë‚´ìš©**:
- ì§€ì—­ëª…ìœ¼ë¡œ ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰ (FD6 + CE7)
- `meta.total_count` í™•ì¸í•˜ì—¬ 50ê°œ ì´ˆê³¼ ì—¬ë¶€ íŒë‹¨
- 50ê°œ ì´ˆê³¼ ì‹œ ì§€ì—­ ì„¸ë¶„í™” ì œì•ˆ ìƒì„±

### Phase 2: ì¼ê´„ ìœ„ìƒì •ë³´ ì¡°íšŒ ì„œë¹„ìŠ¤

**íŒŒì¼**: `src/services/bulk-hygiene.service.ts` (ì‹ ê·œ)

```typescript
interface BulkHygieneResult {
  totalChecked: number;
  matchedCount: number;
  results: RestaurantHygieneInfo[];
}

async getBulkHygieneInfo(
  restaurants: RestaurantInfo[],
  filter: 'all' | 'clean' | 'with_violations' | 'no_grade',
  limit: number
): Promise<BulkHygieneResult>
```

**êµ¬í˜„ ë‚´ìš©**:
- ë³‘ë ¬ API í˜¸ì¶œë¡œ ì„±ëŠ¥ ìµœì í™” (Promise.allSettled)
- í•„í„° ì¡°ê±´ì— ë”°ë¥¸ ê²°ê³¼ í•„í„°ë§
- ì‹¤íŒ¨í•œ ì¡°íšŒëŠ” ê±´ë„ˆë›°ê¸° (ë¶€ë¶„ ì„±ê³µ í—ˆìš©)

### Phase 3: ìƒˆ MCP ë„êµ¬ ë“±ë¡

**íŒŒì¼**: `src/index.ts`

```typescript
// ê¸°ì¡´
tools: [get_restaurant_hygiene]

// ì¶”ê°€
tools: [
  get_restaurant_hygiene,
  search_area_restaurants,
  get_bulk_hygiene_info
]
```

### Phase 4: ì»¨íŠ¸ë¡¤ëŸ¬ ì—…ë°ì´íŠ¸

**íŒŒì¼**: `src/modules/mcp/mcp.controller.ts`

- ìƒˆ ë„êµ¬ í•¸ë“¤ëŸ¬ ì¶”ê°€
- REST API ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€ (ì„ íƒ)

### Phase 5: í…ŒìŠ¤íŠ¸

- ë‹¨ìœ„ í…ŒìŠ¤íŠ¸: ê° ì„œë¹„ìŠ¤ ë©”ì„œë“œ
- í†µí•© í…ŒìŠ¤íŠ¸: MCP ë„êµ¬ í˜¸ì¶œ ì‹œë‚˜ë¦¬ì˜¤
- E2E í…ŒìŠ¤íŠ¸: ëŒ€í™” í”Œë¡œìš° ì‹œë®¬ë ˆì´ì…˜

---

## íŒŒì¼ êµ¬ì¡° ë³€ê²½

```
src/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ kakao-map.service.ts      # ìˆ˜ì •: searchByArea ì¶”ê°€
â”‚   â”œâ”€â”€ bulk-hygiene.service.ts   # ì‹ ê·œ: ì¼ê´„ ì¡°íšŒ ì„œë¹„ìŠ¤
â”‚   â””â”€â”€ ...
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ restaurant-hygiene.core.ts  # ìœ ì§€
â”‚   â””â”€â”€ area-search.core.ts         # ì‹ ê·œ: ì§€ì—­ ê²€ìƒ‰ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°
â”œâ”€â”€ types/
â”‚   â””â”€â”€ area-search.types.ts        # ì‹ ê·œ: ì§€ì—­ ê²€ìƒ‰ íƒ€ì…
â””â”€â”€ index.ts                        # ìˆ˜ì •: ìƒˆ ë„êµ¬ ë“±ë¡
```

---

## API í˜¸ì¶œ ìµœì í™”

### ë³‘ë ¬ ì²˜ë¦¬ ì „ëµ

```typescript
// 45ê°œ ì‹ë‹¹ ì¡°íšŒ ì‹œ
const results = await Promise.allSettled(
  restaurants.map(r =>
    Promise.all([
      hygieneGradeService.findExactMatch(r.name, r.region),
      violationService.getViolationsForRestaurant(r.name, r.region)
    ])
  )
);
```

### ìºì‹± ê³ ë ¤ì‚¬í•­

- ì‹ì•½ì²˜ API ê²°ê³¼ ìºì‹± (TTL: 1ì¼)
- ì¹´ì¹´ì˜¤ë§µ ê²°ê³¼ ìºì‹± (TTL: 1ì‹œê°„)
- í˜„ì¬: ìºì‹± ë¯¸êµ¬í˜„ â†’ í–¥í›„ Redis ë„ì… ê°€ëŠ¥

---

## ì˜ˆìƒ ì†Œìš” ì‹œê°„

| Phase | ì‘ì—… ë‚´ìš© | ì˜ˆìƒ |
|-------|----------|------|
| 1 | ì¹´ì¹´ì˜¤ë§µ ì„œë¹„ìŠ¤ í™•ì¥ | - |
| 2 | ì¼ê´„ ìœ„ìƒì •ë³´ ì„œë¹„ìŠ¤ | - |
| 3 | MCP ë„êµ¬ ë“±ë¡ | - |
| 4 | ì»¨íŠ¸ë¡¤ëŸ¬ ì—…ë°ì´íŠ¸ | - |
| 5 | í…ŒìŠ¤íŠ¸ ì‘ì„± | - |
| **í•©ê³„** | | - |

---

## ìœ„í—˜ ìš”ì†Œ ë° ëŒ€ì‘

| ìœ„í—˜ | ì˜í–¥ | ëŒ€ì‘ |
|------|------|------|
| ì‹ì•½ì²˜ API Rate Limit | 45ê°œ ë™ì‹œ í˜¸ì¶œ ì‹œ ì°¨ë‹¨ ê°€ëŠ¥ | ë°°ì¹˜ ì²˜ë¦¬ (10ê°œì”©) + ë”œë ˆì´ |
| ì¹´ì¹´ì˜¤ë§µ 45ê°œ ì œí•œ | ì „ì²´ ëª©ë¡ ì¡°íšŒ ë¶ˆê°€ | ì‚¬ìš©ìì—ê²Œ ì•ˆë‚´ + ì§€ì—­ ì„¸ë¶„í™” |
| ìœ„ìƒë“±ê¸‰ ë¯¸ë“±ë¡ ì‹ë‹¹ ë‹¤ìˆ˜ | ì¶”ì²œ ê²°ê³¼ ë¶€ì¡± | ì¹´ì¹´ì˜¤ë§µ ì •ë³´ë¼ë„ ì œê³µ |
| Cold Start ì§€ì—° | ì¼ê´„ ì¡°íšŒ ì‹œ íƒ€ì„ì•„ì›ƒ | ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ê³ ë ¤ |

---

## ì„±ê³µ ì§€í‘œ

1. **ê¸°ëŠ¥ ë™ì‘**: ì§€ì—­ ê¸°ë°˜ ê²€ìƒ‰ ë° ì¶”ì²œ ì •ìƒ ë™ì‘
2. **ì‘ë‹µ ì‹œê°„**: 50ê°œ ì´í•˜ ì§€ì—­ ì¡°íšŒ < 10ì´ˆ
3. **ì •í™•ë„**: í•„í„° ì¡°ê±´ì— ë§ëŠ” ì‹ë‹¹ë§Œ ë°˜í™˜
4. **ì‚¬ìš©ì„±**: Claudeê°€ ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™”ë¡œ ì§€ì—­ ì„¸ë¶„í™” ìœ ë„

---

## ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] Phase 1: ì¹´ì¹´ì˜¤ë§µ searchByArea êµ¬í˜„
- [ ] Phase 2: BulkHygieneService êµ¬í˜„
- [ ] Phase 3: MCP ë„êµ¬ ë“±ë¡ (search_area_restaurants, get_bulk_hygiene_info)
- [ ] Phase 4: MCP ì»¨íŠ¸ë¡¤ëŸ¬ í•¸ë“¤ëŸ¬ ì¶”ê°€
- [ ] Phase 5: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±
- [ ] Phase 5: í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„±
- [ ] ë¹Œë“œ ë° ë°°í¬ ê²€ì¦
