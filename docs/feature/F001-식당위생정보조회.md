# [F001] 식당 위생 정보 조회

## 1. 기능 개요

| 항목 | 내용 |
|------|------|
| 기능명 | 식당 위생 정보 조회 |
| 목적 | 사용자가 특정 식당의 위생 등급과 행정처분 이력을 한 번에 확인할 수 있도록 함 |
| 한 줄 설명 | 식당명과 지역을 기반으로 식약처 공인 위생 등급 및 행정처분 기록을 조회하는 기능 |

## 2. 유저 스토리

### US-001: 위생 등급 확인
> **As a** 외식을 계획하는 사용자
> **I want** 특정 식당의 식약처 위생 등급을 확인하고 싶다
> **So that** 국가가 인증한 깨끗한 식당을 선택할 수 있다

### US-002: 행정처분 이력 확인
> **As a** 식당 위생을 중요시하는 사용자
> **I want** 특정 식당의 과거 행정처분 이력을 알고 싶다
> **So that** 위생 문제가 있었던 업소를 사전에 회피할 수 있다

## 3. 사용자 시나리오

### 3.1 정상 시나리오

#### S-001: 위생 등급 보유 식당 조회
1. 사용자가 "종로에 있는 맛있는 마라탕 위생 어때?"라고 질문
2. AI가 자연어에서 식당명(`맛있는 마라탕`)과 지역(`종로`)을 파싱
3. 시스템이 공공데이터포털 API를 통해 해당 식당 검색
4. 위생 등급(AA) 및 행정처분 이력(없음) 조회
5. 사용자에게 결과 반환:
   - 위생등급: ★★ 우수 (AA)
   - 행정처분: 최근 3년간 이력 없음

#### S-002: 위생 등급 미보유 식당 조회
1. 사용자가 "강남 김밥천국 위생 정보 알려줘"라고 질문
2. AI가 식당명(`김밥천국`)과 지역(`강남`)을 파싱
3. 시스템이 API를 통해 검색
4. 위생 등급 정보 없음, 행정처분 1건 발견
5. 사용자에게 결과 반환:
   - 위생등급: 등급 미보유
   - 행정처분: 2023.05 과태료 (유통기한 경과 제품 사용)

#### S-003: 처분 이력 다수 존재
1. 사용자가 특정 식당 조회
2. 행정처분 이력 3건 이상 발견
3. 최근 3건을 시간순 정렬하여 반환
4. 추가 이력 존재 시 "외 N건" 표시

### 3.2 예외 시나리오

#### E-001: 식당을 찾을 수 없음
- **상황**: 입력한 식당명/지역으로 검색 결과 없음
- **응답**: "해당 조건으로 식당을 찾을 수 없습니다. 식당명이나 지역을 다시 확인해주세요."

#### E-002: 동일 이름 식당 다수 존재
- **상황**: 같은 지역에 동일 상호 2개 이상
- **응답**: 검색된 식당 목록 제시 후 선택 요청
  - "종로구에 '맛있는 마라탕'이 2곳 있습니다: 1) 종로3가점 2) 광화문점. 어느 곳을 확인할까요?"

#### E-003: API 호출 실패
- **상황**: 공공데이터포털 API 응답 없음 또는 오류
- **응답**: "현재 식약처 데이터를 조회할 수 없습니다. 잠시 후 다시 시도해주세요."

#### E-004: 필수 정보 누락
- **상황**: 식당명 또는 지역 정보가 불명확
- **응답**: "어느 지역의 식당인지 알려주시겠어요?" 또는 "식당 이름을 알려주세요."

## 4. 입력-출력

### 4.1 입력 (MCP Tool Parameters)

| 파라미터 | 타입 | 필수 | 설명 | 예시 |
|----------|------|------|------|------|
| `restaurant_name` | string | Y | 식당 상호명 | "맛있는 마라탕" |
| `region` | string | Y | 지역명 (시/구/동) | "종로구" |
| `include_history` | boolean | N | 행정처분 이력 포함 여부 (기본값: true) | true |

### 4.2 출력

```json
{
  "restaurant": {
    "name": "맛있는 마라탕",
    "address": "서울특별시 종로구 종로3가 123-45",
    "business_type": "중국식"
  },
  "hygiene_grade": {
    "has_grade": true,
    "grade": "AA",
    "grade_label": "우수",
    "grade_date": "2024-03-15",
    "stars": 2
  },
  "violations": {
    "total_count": 0,
    "recent_items": [],
    "has_more": false
  }
}
```

### 4.3 위생 등급 체계

| 등급 | 라벨 | 별점 표시 |
|------|------|-----------|
| AAA | 매우 우수 | ★★★ |
| AA | 우수 | ★★ |
| A | 좋음 | ★ |
| - | 등급 미보유 | - |

## 5. 의존성

### 5.1 외부 API
| API | 용도 | 제공처 |
|-----|------|--------|
| 식품안전정보 위생등급 API | 위생 등급 조회 | 공공데이터포털 |
| 행정처분 공개 API | 처분 이력 조회 | 공공데이터포털 |

### 5.2 내부 의존성
- 없음 (독립 기능)

### 5.3 연관 기능
- F002-AI요약응답: 본 기능의 출력을 입력으로 받아 요약 생성

## 6. 성공 기준

| 지표 | 기준 | 측정 방법 |
|------|------|-----------|
| 검색 성공률 | 90% 이상 | 유효한 요청 대비 결과 반환 비율 |
| API 응답 시간 | 3초 이내 | 요청~응답 완료 시간 |
| 데이터 정확도 | 100% | 식약처 원본 데이터와 일치 여부 |

## 7. 우선순위

**P0 (Must Have)**

- 서비스의 핵심 가치를 전달하는 필수 기능
- 이 기능 없이는 서비스 존재 의미 없음

## 8. 제약사항

### 8.1 기술적 제약
- 공공데이터포털 API 일일 호출 한도 준수 필요
- API 키 발급 및 승인 절차 필요 (1-3일 소요)

### 8.2 데이터 제약
- 위생 등급: 자발적 신청 업소만 보유 (전체 식당의 일부)
- 행정처분: 공개 기간 제한 있을 수 있음 (확인 필요)

### 8.3 비즈니스 제약
- 조회 결과는 식약처 공식 데이터 기반임을 명시해야 함
- 데이터 업데이트 주기에 따른 시차 발생 가능성 고지 필요
